(function(a){jQuery.sheet.dts={toTables:{json:function(c){var b=a([]);a.each(c,function(){var g=a("<table />");if(this["title"]){g.attr("title",this["title"]||"");}b=b.add(g);a.each(this["rows"],function(){if(this["height"]){var h=a("<tr />").attr("height",this["height"]).css("height",this["height"]).appendTo(g);}a.each(this["columns"],function(){var i=a("<td />").appendTo(h);if(this["class"]){i.attr("class",this["class"]||"");}if(this["style"]){i.attr("style",this["style"]||"");}if(this["formula"]){i.data("formula",(this["formula"]?"="+this["formula"]:""));}if(this["value"]){i.html(this["value"]||"");}});});if(!this["metadata"]){return;}if(this["metadata"]["widths"]){var d=a("<colgroup />").prependTo(g);for(var f in this["metadata"]["widths"]){var e=a("<col />").attr("width",this["metadata"]["widths"][f]).css("width",this["metadata"]["widths"][f]).appendTo(d);}}if(this["metadata"]["frozenAt"]){if(this["metadata"]["frozenAt"]["row"]){g.data("frozenatrow",this["metadata"]["frozenAt"]["row"]);}if(this["metadata"]["frozenAt"]["col"]){g.data("frozenatcol",this["metadata"]["frozenAt"]["col"]);}}});return b;},xml:function(b){b=a.parseXML(b);var c=a([]);a.each(b.childNodes,function(e,d){a.each(this.childNodes,function(i,f){var k=a("<table />").attr("title",(this.attributes["title"]?this.attributes["title"].nodeValue:"")),g=a("<colgroup/>").appendTo(k),h=a("<tbody />").appendTo(k);c=c.add(k);a.each(this.childNodes,function(j,l){switch(this.nodeName.toLowerCase()){case"rows":a.each(this.childNodes,function(m,o){switch(this.nodeName.toLowerCase()){case"row":var n=a("<tr/>").appendTo(h);if(this.attributes["height"]){n.css("height",(this.attributes["height"]?this.attributes["height"].nodeValue:"")).attr("height",(this.attributes["height"]?this.attributes["height"].nodeValue:""));}a.each(this.childNodes,function(p,q){switch(this.nodeName.toLowerCase()){case"columns":a.each(this.childNodes,function(t,r){switch(this.nodeName.toLowerCase()){case"column":var s=a("<td />").appendTo(n);a.each(this.childNodes,function(v,u){switch(this.nodeName.toLowerCase()){case"formula":s.data("formula","="+(this.textContent||this.text));break;case"value":s.html(this.textContent||this.text);break;case"style":s.attr("style",this.textContent||this.text);break;case"class":s.attr("class",this.textContent||this.text);}});break;}});}});break;}});break;case"metadata":a.each(this.childNodes,function(){switch(this.nodeName.toLowerCase()){case"frozenat":a.each(this.childNodes,function(){switch(this.nodeName.toLowerCase()){case"row":k.data("frozenatrow",(this.textContent||this.text)*1);break;case"col":k.data("frozenatcol",(this.textContent||this.text)*1);break;}});break;case"widths":a.each(this.childNodes,function(){switch(this.nodeName.toLowerCase()){case"width":a("<col/>").attr("width",this.textContent||this.text).css("width",this.textContent||this.text).appendTo(g);break;}});break;}});break;}});});});return c;}},fromTables:{json:function(h){var d=[],g=1*h.i;for(var k in h.spreadsheets){h.i=k;h.evt.cellEditDone();var l=[];var c={"title":(h.obj.sheet().attr("title")||""),"rows":[],"metadata":{"widths":[],"frozenAt":a.extend({},h.frozenAt())}};d.push(c);for(var q in h.spreadsheets[k]){if(q==0){continue;}var n=h.spreadsheets[k][q][1].td[0].parentNode.attributes,b={"height":null,"columns":[],"height":(n["height"]?n["height"].value:h.s.colMargin+"px")};c.rows.push(b);for(var f in h.spreadsheets[k][q]){if(f==0){continue;}var p=h.spreadsheets[k][q][f],e={},j=p.td[0].attributes,o=(j["class"]?a.trim((j["class"].value||"").replace(h.cl.uiCellActive,"").replace(h.cl.uiCellHighlighted,"")):""),m=p.td[0].parentNode;b.columns.push(e);if(!b["height"]){b["height"]=(m.attributes["height"]?m.attributes["height"].value:h.s.colMargin+"px");}if(p["formula"]){e["formula"]=p["formula"];}if(p["value"]){e["value"]=p["value"];}if(j["style"]&&j["style"].value){e["style"]=j["style"].value;}if(o.length){e["class"]=o;}if(q*1==1){c.metadata.widths.push(a(h.col(null,f)).css("width"));}}}}h.i=g;return d;},xml:function(f){var b='<?xml version="1.0" encoding="UTF-8"?><spreadsheets xmlns="http://www.w3.org/1999/xhtml">',e=1*f.i;for(var h in f.spreadsheets){f.i=h;f.evt.cellEditDone();var m=a.extend({},f.frozenAt()),d=[];b+='<spreadsheet title="'+(f.obj.sheet().attr("title")||"")+'">';b+="<rows>";for(var n in f.spreadsheets[h]){if(n==0){continue;}var j=f.spreadsheets[h][n][1].td[0].parentNode.attributes;b+='<row height="'+(j["height"]?j["height"].value:f.s.colMargin+"px")+'">';b+="<columns>";for(var c in f.spreadsheets[h][n]){if(c==0){continue;}var l=f.spreadsheets[h][n][c],g=l.td[0].attributes,k=(g["class"]?a.trim((g["class"].value||"").replace(f.cl.uiCellActive,"").replace(f.cl.uiCellHighlighted,"")):"");b+="<column>";if(l.formula){b+="<formula>"+l.formula+"</formula>";}if(l.value){b+="<value>"+l.value+"</value>";}if(g["style"]){b+="<style>"+g["style"].value+"</style>";}if(k){b+="<class>"+k+"</class>";}b+="</column>";if(n*1==1){d[c]="<width>"+a(f.col(null,c)).css("width")+"</width>";}}b+="</columns>";b+="</row>";}b+="</rows>";b+="<metadata>"+(m.row||m.col?"<frozenAt>"+(m.row?"<row>"+m.row+"</row>":"")+(m.col?"<col>"+m.col+"</col>":"")+"</frozenAt>":"")+"<widths>"+d.join("")+"</widths>"+"</metadata>";b+="</spreadsheet>";}b+="</spreadsheets>";f.i=e;return b;}}};})(jQuery);